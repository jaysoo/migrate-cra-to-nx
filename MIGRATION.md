# Migrating CRA to Nx

1. Create Nx workspace

    ```
    create-nx-workspace acme --appName=webapp --preset=react --style=css --nx-cloud
    ```

2. Add npm packages that CRA needs

    ```
    yarn add --dev react-scripts @testing-library/jest-dom eslint-config-react-app
    ```
   
3. Remove the `architect` entry from project config in `workspace.json`

    ```
    {
      "version": 1,
      "projects": {
        "webapp": {
          "root": "apps/webapp",
          "sourceRoot": "apps/webapp/src",
          "projectType": "application",
          "schematics": {}
        },
        ...
      }
    }
    ```

4. Replace code generated by Nx with the CRA app (assuming the CRA app was created with `--template typescript`)

    ```
    rm -rf apps/webapp/*
    cp -r /path/to/cra-app/{README.md,package.json,tsconfig.json,src,public} apps/webapp
    ```
   
5. Add `"extends": "../../tsconfig.json"` to `apps/webapp/tsconfig.json` --this is needed to resolve workspace projects


6. Add CRA commands

    ```
    nx g @nrwl/workspace:run-commands serve \
    --project webapp \
    --command "npx react-scripts start" -\
    -cwd "apps/webapp"
    
    nx g @nrwl/workspace:run-commands build \
    --project webapp \
    --command "react-scripts build" \
    --cwd "apps/webapp" \
    --outputs "npx apps/webapp/build"
    
    nx g @nrwl/workspace:run-commands lint \
    --project webapp \
    --command "npx eslint src/**/*.tsx src/**/*.ts" \
    --cwd "apps/webapp"
    
    nx g @nrwl/workspace:run-commands test \
    --project webapp \
    --command "npx react-scripts test --watchAll=false" \
    --cwd "apps/webapp"
    ```
    
    **Note:** The `--cwd` and `--outputs` options are not yet supported by the schematic. This will be fixed in a future release. For now, add the entries manually as follows:
    
    ```
    "webapp": {
      "root": "apps/webapp",
      "sourceRoot": "apps/webapp/src",
      "projectType": "application",
      "schematics": {},
      "architect": {
        "serve": {
          "builder": "@nrwl/workspace:run-commands",
          "options": {
            "cwd": "apps/webapp",
            "command": "node ../../node_modules/.bin/react-scripts start"
          }
        },
        "build": {
          "builder": "@nrwl/workspace:run-commands",
          "outputs": ["apps/webapp/build"],
          "options": {
            "cwd": "apps/webapp",
            "command": "node ../../node_modules/.bin/react-scripts build"
          }
        },
        "lint": {
          "builder": "@nrwl/workspace:run-commands",
          "options": {
            "cwd": "apps/webapp",
            "command": "node ../../node_modules/.bin/eslint src/**/*.tsx src/**/*.ts"
          }
        },
        "test": {
          "builder": "@nrwl/workspace:run-commands",
          "options": {
            "cwd": "apps/webapp",
            "command": "node ../../node_modules/.bin/react-scripts test --watchAll=false"
          }
        }
      }
      ```
   
7. Skip CRA preflight check since Nx manages the monorepo.

    ```
    echo "SKIP_PREFLIGHT_CHECK=true" > .env
    ```
   
8. Ignore folder for production build.

    ```
    echo "apps/webapp/build" >> .gitignore
    echo "apps/webapp/node_modules" >> .gitignore
    ```
   
9. Try the commands

    ```
    nx serve webapp
    nx build webapp
    nx lint webapp
    nx test webapp
    ```
   
10. Try the `build`, `lint`, and `test` commands again and noticed that Nx caches their results!
